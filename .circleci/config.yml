version: 2.1

orbs:
  path-filtering: circleci/path-filtering@0.1.3

parameters:
  deploy-model1:
    type: boolean
    default: false
  deploy-model2:
    type: boolean
    default: false

executors:
  python:
    docker:
      - image: python:3.11
    environment:
      AWS_ACCESS_KEY: $AWS_ACCESS_KEY
      AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
      MY_ENV_VAR: $MY_ENV_VAR

jobs:
  gather-data:
    executor: python
    steps:
      - checkout
      - run: echo $MY_ENV_VAR

workflows:
  train-and-deploy:
    jobs:
      - path-filtering/filter:
          # Compare files on main
          base-revision: main
          # 3-column space-separated table for mapping: `path-to-test parameter-toset value-for-parameter` for each row
          mapping: |
            model1/.* deploy-model1 true
            model2/.* deploy-model2 true
      - gather-data
